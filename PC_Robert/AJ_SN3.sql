/*
SELECT * --DISTINCT N4_CBASE, N4_ITEM, N4_TIPO
FROM SN4010
--BEGIN TRAN; UPDATE SN4010 SET D_E_L_E_T_ = '*'
WHERE D_E_L_E_T_ = ''
AND N4_FILIAL = '01'
AND N4_DATA = '20240131'
AND N4_OCORR != '01'
ORDER BY N4_CBASE, N4_ITEM, N4_TIPO
--COMMIT
*/
;

SELECT SN3.N3_CRIDEPR, N3_VRDMES1, N3_VRDACM1, (N3_VRDACM1 - N3_VRDMES1) AS VALOR_NOVO,  *
fROM SN3010 SN3
--BEGIN TRAN; UPDATE SN3010 SET N3_VRDACM1 = (N3_VRDACM1 - N3_VRDMES1)
WHERE D_E_L_E_T_ = ''
AND N3_FILIAL = '01'
AND N3_DTBAIXA LIKE '202401%'
AND N3_VRDMES1 > 0
AND EXISTS (SELECT * FROM SN4010
			WHERE D_E_L_E_T_ = '*'
			AND N4_FILIAL = '01'
			AND N4_DATA = '20240131'
			AND N4_IDMOV = '0000017173'
			AND N4_OCORR != '01'
			AND N4_CBASE = N3_CBASE
			AND N4_ITEM = N3_ITEM
			AND N4_TIPO = N3_TIPO)
--AND N3_CBASE != '0000001381'
ORDER BY N3_FILIAL, N3_CBASE, N3_ITEM, N3_TIPO
--ROLLBACK
--COMMIT
