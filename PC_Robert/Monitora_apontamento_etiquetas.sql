-- set TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
/* estatisticas:
declare @DATAINI VARCHAR (8) = '20221005'

SELECT D3.*, COLETOR.VIA_COLETOR, COLETOR.TEMPO_MEDIO_COLETOR, COLETOR.MAIOR_TEMPO_COLETOR
FROM (SELECT D3_EMISSAO, D3_USUARIO, COUNT (*) AS TOTAL_APONTAMENTOS
		FROM SD3010 SD3
		WHERE SD3.D_E_L_E_T_ = ''
		AND SD3.D3_FILIAL = '01'
		AND SD3.D3_VAETIQ != ''
		AND SD3.D3_CF LIKE 'PR%'
		--AND UPPER (SUBSTRING (SD3.D3_USUARIO, 1, 15)) = SUBSTRING (NOME, 1, 15)
		--AND SD3.D3_EMISSAO = FORMAT (ENTRADA, 'yyyyMMdd')
		AND SD3.D3_EMISSAO >= @DATAINI
GROUP BY SD3.D3_EMISSAO, SD3.D3_USUARIO
) AS D3
LEFT JOIN (SELECT FORMAT (ENTRADA, 'yyyyMMdd') AS DIA, NOME, COUNT (*) AS VIA_COLETOR
	,AVG (DATEDIFF (SECOND, ENTRADA, SAIDA)) AS TEMPO_MEDIO_COLETOR
	,MAX (DATEDIFF (SECOND, ENTRADA, SAIDA)) AS MAIOR_TEMPO_COLETOR
from VA_USOROT
WHERE ENTRADA >= @DATAINI + ' 00:00'
AND ROTINA = 'ApontarProducaoEtqCo'  DESATUALIZADA... AGORA EH POR TELNET
GROUP BY FORMAT (ENTRADA, 'yyyyMMdd')
, NOME
) AS COLETOR
ON (COLETOR.DIA = D3.D3_EMISSAO
AND SUBSTRING (COLETOR.NOME, 1, 15) = UPPER (SUBSTRING (D3.D3_USUARIO, 1, 15))
)
ORDER BY D3.D3_EMISSAO
*/

/*
--SELECT * FROM VA_PERFMON WHERE DTHR >= '20220601' AND upper (CHAVE) like 'APONTARPRODUCAOET%'
SELECT TOP 1 D3_VAETIQ, D3_COD
FROM SD3010
WHERE D_E_L_E_T_ = ''
AND D3_FILIAL = '01'
AND D3_VAETIQ != ''
AND D3_CF LIKE 'PR%'
AND D3_EMISSAO = '20220727'
SELECT B1_CODBAR FROM SB1010 WHERE B1_COD = '0345'
*/

-- DADOS DE ALGUMA ETIQUETA PARA SIMULAR APONTAMENTO
SELECT ZA1.ZA1_PROD, SB1.B1_CODBAR, B1_DESC, ZA1.*
FROM ZA1010 ZA1, SB1010 SB1
WHERE ZA1.D_E_L_E_T_ = ''
AND ZA1_IMPRES = 'S'
AND ZA1_DATA >= '20220801'
AND ZA1.ZA1_CODIGO BETWEEN '2000551353' and '2000551404'
AND SB1.D_E_L_E_T_ = '' AND SB1.B1_FILIAL = '  ' AND SB1.B1_COD = ZA1.ZA1_PROD
AND EXISTS (SELECT * FROM SC2010 SC2 WHERE SC2.D_E_L_E_T_ = '' AND SC2.C2_FILIAL = ZA1.ZA1_FILIAL AND SC2.C2_NUM + SC2.C2_ITEM + SC2.C2_SEQUEN + SC2.C2_ITEMGRD = ZA1.ZA1_OP AND SC2.C2_DATRF = '')
AND ZA1_APONT != 'S'

select B1_CODBAR, * from SB1010 WHERE B1_CODBAR LIKE '17891103207805%'
select B1_CODBAR, * from SB1010 WHERE B1_COD = '30040          '
>>*0187898925498137<<

SELECT TOP 100 * FROM SC2010 where C2_FILIAL = '01' AND C2_NUM = '128831'

-- ETIQUETAS APONTADAS E QUE NAO FORAM ENVIADAS PARA O FULL
SELECT SD3.D3_VAETIQ
FROM SD3010 SD3 WHERE SD3.D_E_L_E_T_ = '' AND SD3.D3_FILIAL = '01' AND SD3.D3_VAETIQ != '' AND SD3.D3_ESTORNO != 'S'
AND SD3.D3_EMISSAO = '20221005'
--AND NOT EXISTS (select * from tb_wms_etiquetas where id = SD3.D3_VAETIQ)
AND NOT EXISTS (select * from tb_wms_entrada where dthr >= '20221005 00:00' and codfor = SD3.D3_VAETIQ)
ORDER BY SD3.D3_VAETIQ

SELECT B1_CODBAR, * FROM SB1010 WHERE B1_CODBAR = '17891103207836 '
SELECT * FROM SC2010 WHERE C2_FILIAL = '01' AND D_E_L_E_T_ = '' AND C2_PRODUTO IN ('4563','30040') AND C2_DATRF = ''-- AND C2_NUM = '128643'
