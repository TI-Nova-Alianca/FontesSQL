--DELETE VA_SIMUL_LCTOS WHERE TABELA = 'SD1'

SELECT ROUND (CASE CTADEB WHEN '' THEN 0 ELSE VALOR END, 2) AS VLR_DEB
	, ROUND (CASE CTACRED WHEN '' THEN 0 ELSE VALOR END, 2) AS VLR_CRED
	, V.LPAD, V.SEQ
	, V.CTADEB, (SELECT CT1_DESC01
				FROM CT1010 CT1_D
				WHERE CT1_D.D_E_L_E_T_ = '' AND CT1_D.CT1_FILIAL = '  ' AND CT1_D.CT1_CONTA = V.CTADEB) AS DESC_DEB
	, V.CTACRED--, CT1_C.CT1_DESC01
	, V.HIST, V.TABELA, V.RECNO
	--, V.*
--	, SD3.D3_EMISSAO, SD3.D3_DOC, SD3.D3_COD, D3_OP, B1_TIPO as TIPO_PROD_FINAL
--	, SD1.D1_DTDIGIT, SD1.D1_DOC, SD1.D1_SERIE, SD1.D1_FORNECE, SD1.D1_LOJA, SD1.D1_TIPO, SD1.D1_COD, SD1.D1_TP, SD1.D1_TES, SF4_E.F4_PODER3, SD1.D1_CUSTO
	, SD2.D2_EMISSAO, SD2.D2_DOC, SD2.D2_SERIE, SD2.D2_CLIENTE, SD2.D2_LOJA, SD2.D2_TIPO, SD2.D2_COD, SD2.D2_TP, SD2.D2_TES, SF4_S.F4_PODER3
FROM VA_SIMUL_LCTOS V
	
--	LEFT JOIN CT1010 CT1_C
--		ON (CT1_C.D_E_L_E_T_ = '' AND CT1_C.CT1_FILIAL = '  ' AND CT1_C.CT1_CONTA = V.CTACRED)
--	INNER JOIN SD1010 SD1
--			INNER JOIN SF4010 SF4_E ON (SF4_E.D_E_L_E_T_ = '' AND SF4_E.F4_FILIAL = '  ' AND SF4_E.F4_CODIGO = SD1.D1_TES)
--		ON (SD1.D_E_L_E_T_ = '' AND SD1.R_E_C_N_O_ = V.RECNO)
	LEFT JOIN SD2010 SD2
			LEFT JOIN SF4010 SF4_S ON (SF4_S.D_E_L_E_T_ = '' AND SF4_S.F4_FILIAL = '  ' AND SF4_S.F4_CODIGO = SD2.D2_TES)
		ON (V.TABELA = 'SD2' AND SD2.D_E_L_E_T_ = '' AND SD2.R_E_C_N_O_ = V.RECNO)
--	LEFT JOIN SD3010 SD3
--		LEFT JOIN SC2010 SC2
--			INNER JOIN SB1010 SB1 ON (SB1.D_E_L_E_T_ = '' AND SB1.B1_FILIAL = '  ' AND SB1.B1_COD = SC2.C2_PRODUTO)
--				ON (SC2.D_E_L_E_T_ = ''
--				AND SC2.C2_FILIAL = D3_FILIAL
--				AND SC2.C2_NUM = SUBSTRING(D3_OP, 1, 6)
--				AND SC2.C2_ITEM = SUBSTRING(D3_OP, 7, 2)
--				AND SC2.C2_SEQUEN = SUBSTRING(D3_OP, 9, 3)
--				AND SC2.C2_ITEMGRD = SUBSTRING(D3_OP, 12, 2))
--		ON (V.TABELA = 'SD3' AND SD3.D_E_L_E_T_ = '' AND SD3.R_E_C_N_O_ = V.RECNO)
--SELECT * FROM VA_SIMUL_LCTOS
WHERE TABELA = 'SD2'
and LPAD = '610'
--and RECNO IN (843901,843902,843903)
--AND SF4_E.F4_PODER3 IN ('R', 'D') 
--AND (V.CTADEB = '101030101011' OR V.CTACRED = '101030101011')
--AND D2_DOC IN ('520003','519996')
AND D2_DOC IN ('508789','518284','518285')
/*
-- PROCURA REGISTROS DO QUE TENHAM SIDO CONTABILIZADOS MAIS DE UMA VEZ
SELECT V.TABELA, V.RECNO, COUNT (*)
FROM VA_SIMUL_LCTOS V
GROUP BY V.TABELA, V.RECNO
HAVING COUNT (*) > 1


-- PROCURA REGISTROS QUE NAO GERARAM NENHUMA CONTABILIZACAO
SELECT R_E_C_N_O_
FROM SD1010 SD1
WHERE SD1.D_E_L_E_T_ = ''
AND SD1.D1_FILIAL = '01'
AND SD1.D1_DTDIGIT BETWEEN '20200101' AND '20200131'
AND NOT EXISTS (SELECT *
				FROM VA_SIMUL_LCTOS V
				WHERE TABELA = 'SD1'
				AND V.RECNO = SD1.R_E_C_N_O_)
--
SELECT R_E_C_N_O_
FROM SD2010 SD2
WHERE SD2.D_E_L_E_T_ = ''
AND SD2.D2_FILIAL = '01'
AND SD2.D2_EMISSAO BETWEEN '20200101' AND '20200131'
AND NOT EXISTS (SELECT *
				FROM VA_SIMUL_LCTOS V
				WHERE TABELA = 'SD2'
				AND V.RECNO = SD2.R_E_C_N_O_)
--
SELECT R_E_C_N_O_
FROM SD3010 SD3
WHERE SD3.D_E_L_E_T_ = ''
AND SD3.D3_FILIAL = '01'
AND SD3.D3_EMISSAO BETWEEN '20200101' AND '20200131'
AND NOT EXISTS (SELECT *
				FROM VA_SIMUL_LCTOS V
				WHERE TABELA = 'SD3'
				AND V.RECNO = SD3.R_E_C_N_O_)


SELECT TABELA, COUNT (*)
FROM VA_SIMUL_LCTOS V
WHERE DHGERACAO >= '20200331'
GROUP BY TABELA
ORDER BY TABELA

*/